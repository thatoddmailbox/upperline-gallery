<link rel="stylesheet" href="css/projects.css" />

<div class="nav">
	<a id="back-url" href="/">Back to Gallery</a><br>
	<p class="lead pageheader">Manage Projects</p>
	<div class="header-links-right">
		<ul>
			<% if not session[:logged_in] %>
				<li><a class="footer-url" target="_parent" href="<%= get_github_url(@CLIENT_ID, @CLIENT_SECRET) %>">Sign in with GitHub</a></li>
			<% else %>
			<div id="git-avatar">
				<li><img style="width:75px; height:75px;" src="<%= URI.encode session[:avatar_url] %>" class="avatar-tiny"/>
				<span id="hidden-username"> Logged in as <br><strong><%=h session[:username]%></strong> </span></li>
			</div>
			<div id="function-stack">
				<li><a class="footer-url" href="/submit"><span style="font-size: 33px;" class="glyphicon glyphicon-plus"></span></a></li>
					<% if session[:is_admin] %>
				<li><a class="footer-url" href="/admin">Admin</a></li>
					<% end %>
				<li><a class="footer-url" href="/logout">Log out</a></li>
					<% end %>
			</div>
		</ul>
	</div>
</div>
<div>
	<div class="unapproved-label">Unapproved projects:</div><br>
	<div class="project-row">
		<% require "redcarpet"
		project_count = 0
		has_ended_div = false
		markdown = Redcarpet::Markdown.new(Redcarpet::Render::HTML.new(render_options = {:escape_html => true}), autolink: true, tables: true) %>

		<% unapproved.each do |project| %>
			<% has_ended_div = false %>
			<% if project_count % 3 == 0 %>
		<div class="project-row">
			<% end %>
			<div class="col-md-4">
				<div class="project-thumb"><img src="<%= get_screenshot_url(project.id, project.url) %>"/></div>
				<div class="project-name"><%= h project.name %> - ID #<%= h project.id %></div>
				<div class="project-authors"><%= h project.authors %></div>
				<div class="project-owner">Owner: <%= h project.owner %><br/></div>
				<div class="project-url"><a href="<%= URI.encode project.url %>" target="_parent"> <i class="glyphicon glyphicon-globe"></i> <%= h project.url %></a></div>
				<div class="project-desc">
				<% if project.description != "" %>
					<%= markdown.render(project.description) %>
				<% else %>
					<em class="no-desc">No description given.</em>
				<% end %>
				</div>

					<% if project.github_repo %>
						GitHub repository: <a href="<%= URI.encode project.github_repo %>" target="_parent"><%= h project.github_repo %></a><br/>
					<% end %>
					<a href="/approve?id=<%= project.id %>" class="btn btn-default btn-lg btn-block url_button">Approve</a>
			</div>
		</div>
		<% end %>
		<% if unapproved.length == 0 %>
			<i>No projects to approve.</i>
		<% end %>
	</div>
</div>
